"use strict";var cl=function(a){return console.log(a)},KMCModule=angular.module("KMCModule",["pascalprecht.translate","ngRoute","KMC.controllers","KMC.filters","KMC.services","KMC.directives","ngAnimate","LocalStorageModule","KMC.menu"]);KMCModule.config(["$routeProvider","$locationProvider","$httpProvider","$tooltipProvider","$translateProvider",function(a,b,c,d,e){e.useStaticFilesLoader({prefix:"i18n/",suffix:".json"}),e.preferredLanguage("en_US"),e.fallbackLanguage("en_US"),-1!=window.location.href.indexOf("debug"),e.useStorage("localStorageService"),d.options({placement:"right",appendToBody:!0,popupDelay:800}),d.setTriggers({customShow:"customShow"}),c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"];var f,g=["$q","$injector",function(a,b){function c(a){return f=f||b.get("$http"),f.pendingRequests.length<1&&(e=e||b.get("requestNotificationChannel"),e.requestEnded()),a}function d(c){return logTime("httpRequest failed -"),f=f||b.get("$http"),f.pendingRequests.length<1&&(e=e||b.get("requestNotificationChannel"),e.requestEnded()),a.reject(c)}var e;return function(a){return e=e||b.get("requestNotificationChannel"),e.requestStarted(),a.then(c,d)}}];c.responseInterceptors.push(g),a.when("/login",{templateUrl:"view/login.html",controller:"LoginCtrl",resolve:{apiService:["api","apiService",function(a,b){return b}]}}),a.when("/list",{templateUrl:"view/list.html",controller:"PlayerListCtrl",resolve:{apiService:["api","apiService","localStorageService","$location",function(a,b,c,d){return h(a,b,c,d).then(function(){return b})}]}});var h=function(a,b,c,d){try{var e=window.parent.kmc;e&&e.vars&&e.vars.ks&&c.add("ks",e.vars.ks)}catch(f){cl("Could not located parent.kmc: "+f)}var g=c.get("ks");return g?(a.then(function(){b.setKs(g)}),a):(d.path("/login"),!1)};a.when("/edit/:id",{templateUrl:"view/edit.html",controller:"PlayerEditCtrl",reloadOnSearch:!1,resolve:{PlayerData:["PlayerService","$route","api","apiService","localStorageService","$location",function(a,b,c,d,e,f){var g=h(c,d,e,f);return g?g.then(function(){return a.getPlayer(b.current.params.id)}):void 0}],editProperties:"editableProperties",menuSvc:"menuSvc"}}),a.when("/newByTemplate",{templateUrl:"view/new-template.html",controller:"PlayerCreateCtrl",reloadOnSearch:!1,resolve:{templates:["playerTemplates",function(a){return a.listSystem()}],userId:function(){return"1"}}}),a.when("/new",{templateUrl:"view/edit.html",controller:"PlayerEditCtrl",reloadOnSearch:!1,resolve:{api:["api","apiService","localStorageService","$location",function(a,b,c,d){return h(a,b,c,d)}],PlayerData:function(a,b){return a.then(function(){return b.newPlayer()})},menuSvc:"menuSvc"}}),a.when("/logout",{resolve:{logout:["localStorageService","apiService","$location",function(a,b,c){a.isSupported()&&a.clearAll(),b.unSetks(),c.path("/login")}]}}),a.otherwise({resolve:{res:["api","apiService","localStorageService","$location",function(a,b,c,d){return h(a,b,c,d)?d.path("/list"):void 0}]}})}]).run(function(a,b,c,d){var e=new Date,f=!1;setTimeout(function(){window.localStorage.setItem("updateHash","true")},1e3),"undefined"!=typeof window.parent.kmc&&$("html").addClass("inKmc");var g=function(a){if(c.search().debug){var b=new Date,d=Math.abs(e.getTime()-b.getTime());cl(a+" "+Math.ceil(d/1e3)+"sec "+d%1e3+"ms")}};window.logTime=g,g("AppJsLoad"),a.constructor.prototype.$safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?this.$eval(a):this.$apply(a)},a.constructor.prototype.openTooltip=function(a){return d.currentTooltip!=a.target?(d.currentTooltip=a.target,$(a.target).trigger("customShow"),a.preventDefault(),a.stopPropagation(),!1):void 0},a.routeName="",a.$on("$routeChangeSuccess",function(){e=new Date;var b=c.url().split("/");f&&c.search({debug:!0}),-1!=b[1].indexOf("?")&&(b[1]=b[1].substr(0,b[1].indexOf("?"))),a.routeName=b[1]}),a.$on("$routeChangeStart",function(){f=c.search().debug?!0:!1});var h=window.parent.kmc;h&&h.vars.studio.showFlashStudio===!1&&$("#flashStudioBtn").hide(),h&&h.vars.studio.showHTMLStudio===!1&&$("#htmlStudioBtn").hide()});var DirectivesModule=angular.module("KMC.directives",["colorpicker.module","ui.bootstrap","ui.select2","ui.sortable"]);DirectivesModule.directive("timeago",[function(){return{restrict:"CA",link:function(a,b){"function"==typeof $.timeago&&a.$observe("timeago",function(c){if(c&&!isNaN(c)){var d=1e3*a.timestamp;b.text($.timeago(d))}})}}}]),DirectivesModule.directive("hiddenValue",[function(){return{template:'<input type="hidden" value="{{model}}"/>',scope:{model:"="},controller:function(a,b,c){c.initvalue&&(a.model=c.initvalue)},restrict:"EA"}}]),DirectivesModule.directive("modelRadio",["menuSvc",function(a){return{restrict:"EA",replace:!0,require:"?playerRefresh",templateUrl:"template/formcontrols/modelRadio.html",scope:{model:"=",strModel:"@model",label:"@",helpnote:"@",require:"@"},controller:["$scope","$element","$attrs",function(b,c,d){var e=a.getControlData(d.model);b.options=e.options;var f,g=[];return{setChoice:function(a){angular.forEach(g,function(b){b.setValue(a)})},registerControl:function(a){g.push(a)},getValue:function(){return b.model},regContoller:function(b){f||a.menuScope.playerEdit.$addControl(b),f=b},isRequired:d.require}}],link:function(a,b,c,d){d&&d.setValueBased(),a.require&&a.$watch("model",function(a){a?$(b).find(".form-group").removeClass("ng-invalid"):$(b).find(".form-group").addClass("ng-invalid")})}}}]),DirectivesModule.directive("dname",["menuSvc",function(a){return{require:"?ngModel",priority:100,link:function(b,c,d,e){if(e){var f=b.$eval(d.dname);c.attr("name",f),e&&(e.$name=f,a.menuScope.playerEdit.$addControl(e))}}}}]),DirectivesModule.directive("valType",function(){return{restrict:"A",link:function(a,b,c){"url"!=c.valType&&"email"!=c.valType||8==window.IE||b.attr("type",c.valType)}}}),DirectivesModule.directive("modelEdit",["$modal",function(a){var b=["$scope",function(a){"undefined"==typeof a.model&&(a.model=""),a.modelValue=a.model}];return{replace:!0,restrict:"EA",scope:{label:"@",helpnote:"@",model:"=",icon:"@",require:"@",strModel:"=model"},controller:b,templateUrl:"template/formcontrols/modelEdit.html",compile:function(b,c){return"true"==c.endline&&b.append("<hr/>"),function(b,c,d){b.doModal=function(){var c=a.open({templateUrl:"template/dialog/textarea.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{close:function(a,d){b.model=d,c.close(a)},title:d.label,message:b.model}}}})}}}}}]),DirectivesModule.directive("modelTags",["menuSvc",function(a){return{replace:!0,restrict:"EA",scope:{label:"@",model:"=",helpnote:"@",icon:"@",strModel:"=model"},controller:["$scope","$element","$attrs",function(b,c,d){b.selectOpts={simple_tags:!0,multiple:!0,tokenSeparators:[","," "]},b.selectOpts.tags=a.doAction(d.source)}],templateUrl:"template/formcontrols/modelTags.html",compile:function(a,b){return"true"==b.endline&&a.append("<hr/>"),function(){}}}}]),DirectivesModule.directive("listEntriesThumbs",function(){return{restrict:"A",controller:["$scope","$element","$attrs",function(a,b,c){if("true"==c.listEntriesThumbs){var d=function(a){return a.thumbnailUrl?"<img class='thumb' src='"+a.thumbnailUrl+"'/>"+a.name:a.name};a.addOption({formatResult:d,formatSelection:d,escapeMarkup:function(a){return a}})}}]}}),DirectivesModule.directive("parentContainer",["sortSvc",function(a){return{restrict:"A",controller:function(){var b={register:function(b,c){a.register(b,c)},update:function(b,c,d){a.update(b,c,d)}};return b}}}]),DirectivesModule.directive("sortOrder",["sortSvc",function(a){return{restrict:"EA",replace:!0,scope:{},templateUrl:"template/formcontrols/sortOrder.html",controller:["$scope",function(b){b.getObjects=function(){b.containers=a.getObjects()},b.getObjects(),a.sortScope=b,b.$on("sortContainersChanged",function(){b.getObjects()}),b.$watchCollection("containers",function(c,d){c!=d&&a.saveOrder(b.containers)}),b.sortableOptions={update:function(){cl(b.containers)},axis:"y"}}],link:function(){}}}]),DirectivesModule.directive("infoAction",["menuSvc",function(a){return{restrict:"EA",replace:"true",controller:["$scope",function(b){b.check=function(b){return a.checkAction(b)},b.btnAction=function(b){a.doAction(b)}}],scope:{model:"=",btnLabel:"@",btnClass:"@",action:"@",helpnote:"@",label:"@"},templateUrl:"template/formcontrols/infoAction.html"}}]),DirectivesModule.directive("prettyRadio",["$rootScope",function(a){return{restrict:"AC",require:["ngModel","^modelRadio"],transclude:"element",controller:function(a,b,c){a.checked=!1,a.setValue=function(b){a.checked=b==c.value?!0:!1},a.$eval(c.model)==c.value&&(a.checked=!0)},compile:function(b,c,d){return function(b,c,e,f){var g=f[0],h=f[1],i=$('<span class="clearfix prettyradio"></span>'),j=$('<a href="#" class=""></a>').appendTo(i);h.registerControl(b),h.regContoller(g);var k=e.value,l="model";"undefined"!=typeof e.model&&(l=e.model),d(b,function(a){return c.replaceWith(i).append(a)}),j.on("click",function(c){return c.preventDefault(),g.$setViewValue(k),a.$safeApply(b,function(){h.setChoice(k)}),!1});var m=function(){h.setChoice(k)};g.$viewChangeListeners.push(m),b.$watch("checked",function(a){a?j.addClass("checked"):j.removeClass("checked")})}}}}]),DirectivesModule.directive("divider",[function(){return{replace:!0,restrict:"EA",template:'<hr class="divider"/>'}}]),DirectivesModule.directive("readOnly",["$filter",function(a){return{restrict:"EA",replace:"true",scope:{model:"=",helpnote:"@"},controller:["$scope","$element","$attrs",function(b,c,d){d.filter&&"function"==typeof a(d.filter)&&(b.model=a(d.filter)(b.model)),d.initvalue&&("undefined"==typeof b.model||""===b.model)&&(b.model=d.initvalue),b.label=d.label+":"}],templateUrl:"template/formcontrols/readOnly.html"}}]),DirectivesModule.directive("modelButton",["menuSvc",function(a){return{restrict:"EA",replace:"true",controller:["$scope",function(b){b.check=function(b){return a.checkAction(b)},b.btnAction=function(b){a.doAction(b)}}],scope:{label:"@",action:"@",btnClass:"@",helpnote:"@"},templateUrl:"template/formcontrols/modelButton.html"}}]),DirectivesModule.directive("onFinishRender",["$timeout","requestNotificationChannel",function(a,b){return{restrict:"A",link:function(c){if(c.$last===!0){var d;d&&a.cancel(d),d=a(function(){b.requestEnded("list"),d=null})}}}}]),DirectivesModule.directive("onbeforeunload",["$window","$filter","$location",function(a,b){function c(){var a,b,c=!1;for(a=0;a<e.length;a++)if(b=e[a],b.scope[b.name].$dirty){c=!0;break}return c?d:void 0}var d,e=[];return function(f,g){if("form"!==g[0].nodeName.toLowerCase())throw new Error("onbeforeunload directive must only be set on a angularjs form!");e.push({name:g[0].name,scope:f});try{d=b("translate")("onbeforeunload")}catch(h){d=""}var i=g[0].name;f.$watch(i+".$dirty",function(b,d){b&&b!=d&&(a.onbeforeunload=c)}),f.$on("$locationChangeSuccess",function(b,c,d){c.split("?")[0]!=d.split("?")[0]&&(a.ononbeforeunload=!1)}),f.$on("$destory",function(){a.ononbeforeunload=!1})}}]),angular.module("KMC.filters",["ngSanitize"]).filter("HTMLunsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("timeago",function(){return function(a){if("function"!=typeof $.timeago||isNaN(a))return a;var b=1e3*a;return $.timeago(b)}}).filter("range",function(){return function(a){var b,c;switch(a.length){case 1:b=0,c=parseInt(a[0])-1;break;case 2:b=parseInt(a[0]),c=parseInt(a[1]);break;default:return a}for(var d=[],e=b;c>=e;e++)d.push(e);return d}}).filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}});var KMCMenu=angular.module("KMC.menu",[]);KMCMenu.controller("menuCntrl",["menuSvc","$scope",function(a,b){logTime("menuCntrl");var c=function(){return $("#mp-menu").width()},d=function(){var a=c();$("#mp-pusher").animate({left:"0"},{duration:200,queue:!0}),$("#mp-menu").animate({left:"-"+a}),$("#mp-pusher >.wrapper").animate({width:"100%"})},e=function(){var a=c();$("#mp-pusher").css({left:a}),$("#mp-menu").css({left:-a})},f=function(){var a=c();$("#mp-pusher").animate({left:a},{duration:200,queue:!0}),$("#mp-menu").animate({left:-a},{duration:200,queue:!1}),$("#mp-pusher >.wrapper").animate({width:"70%"},{duration:200,queue:!0})};b.menuShown=!0,b.menuInitDone=!1,$(window).resize(function(){b.menuShown===!0?e():d()}),b.$on("menuChange",function(){b.menuShown=!0}),b.togglemenu=function(a){b.menuShown=!b.menuShown;var c=$(a.target);c.is("i")&&(c=c.parent("a")),b.menuShown?c.css("transform",""):c.css("transform","rotate(180deg)")},b.$watch("menuShown",function(a,b){a!=b&&(a?f():d())})}]),KMCMenu.factory("menuSvc",["editableProperties","$timeout","$compile","$location","$templateCache",function(editableProperties,$timeout,$compile,$location,$templateCache){var menudata=null;editableProperties.then(function(a){menudata=a});var menuItems=[],menuFn={},refreshableDirectives=function(a){switch(a){case"modaledit":case"select2data":case"dropdown":case"alignment":case"container":case"checkbox":case"color":case"url":case"text":case"number":case"radio":case"multiinput":return!0;default:return!1}},JSON2directiveDictionary=function(a){switch(a){case"modaledit":return"<div model-edit/>";case"divider":return"<div divider/>";case"tags":return"<div model-tags/>";case"select2data":return"<div select2-data/>";case"dropdown":return"<div model-select/>";case"container":return'<div model-select parent-container=""/>';case"checkbox":return"<div model-checkbox/>";case"color":return"<div model-color/>";case"text":return"<div model-text/>";case"url":return'<div model-text validate="url"/>';case"number":return"<div model-number/>";case"readonly":return"<div read-only/>";case"featuremenu":return"<div feature-menu/>";case"radio":return"<div model-radio/>";case"button":return"<div model-button/>";case"infoAction":return"<div info-action/>";case"sortOrder":return"<div sort-order/>";case"hidden":return"<span hidden-value/>";case"multiinput":return"<div multiple-value-input>"}},search=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)&&("label"==d||"children"==d||"object"==typeof b[d])){if(b[d]==c)return a+"['"+d+"']";if("object"==typeof b[d]){var e=search(a+"['"+d+"']",b[d],c);if(e)return e}}return!1},Search4ControlModelData=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)&&("label"==d||"children"==d||"object"==typeof b[d])){if(b[d]&&"undefined"!=typeof b[d].model&&b[d].model==c)return b[d];if("object"==typeof b[d]){var e=Search4ControlModelData(a+"['"+d+"']",b[d],c);if(e)return e}}return!1},menuSvc={menuScope:{},currentTooltip:null,closeTooltips:function(a){menuSvc.currentTooltip&&a.target!=menuSvc.currentTooltip&&($(menuSvc.currentTooltip).trigger("customShow"),menuSvc.currentTooltip=null)},get:function(){return menudata},getModalData:function(a){return menuSvc.menuScope.$eval(a)},setModelData:function(a,b){0!==a.indexOf("data.")&&(a="data."+a);var c=a.substr(0,a.lastIndexOf(".")),d=a.substr(a.lastIndexOf(".")+1),e=menuSvc.getModalData(c);e[d]=b},getOrMakeModelData:function(a,b){var c=menuSvc.getKnownParent(a),d=a.replace(c,"").split(".");return angular.forEach(d,function(a){if(a){var d=menuSvc.getModalData(c)[a]={};b&&(d._featureEnabled=!0),c+="."+a}}),menuSvc.getModalData(a)},getKnownParent:function(a){var b=menuSvc.getModalData(a),c=function(a){return a.substr(0,a.lastIndexOf("."))};for(a=c(a);a&&"undefined"==typeof b;)a=c(a),b=menuSvc.getModalData(a);return a},getControlData:function(a){return"string"==typeof a?(0===a.indexOf("data.")&&(a=a.substr(a.indexOf(".")+1)),Search4ControlModelData("",menudata,a)):void 0},currentPage:"",setMenu:function(a){menuSvc.currentPage=a,$location.search("menuPage",a),"undefined"!=typeof menuSvc.spinnerScope&&"search"!=a&&menuSvc.spinnerScope.spin(),menuSvc.menuScope.$broadcast("menuChange",a)},buildMenu:function(a){if(0===menuItems.length){8==window.IE&&$templateCache.remove("template/menu/menuPage.html");var b=menuSvc.get();angular.forEach(b,function(b){var c=menuSvc.buildMenuItem(b,a);menuFn[c.attr("pagename")]=$compile(c)})}return menuFn},buildMenuItem:function(a,b,c){function d(a,b,c){return angular.forEach(a.children,function(c){switch(c.type){case"menu":b.append(menuSvc.buildMenuItem(c,a.model,a));break;case"featuremenu":b.append(d(c,e(c,"featuremenu")));break;default:b.append(e(c,c.type))}}),c===!0&&b.children().each(function(){$(this).is("menu-level")||$(this).wrap("<li>")}),b}function e(a,b){var c;if("string"!=typeof b||(c=b,b=JSON2directiveDictionary(b))){var d=angular.element(b);return"undefined"!=typeof a.model&&"~"==a.model[0]?d.attr("model",a.model.substr(1)):d.attr("model","data."+a.model),c&&a["player-refresh"]!==!1&&refreshableDirectives(c)&&d.attr("player-refresh",a["player-refresh"]||!0),angular.forEach(a,function(a,b){"model"==b||"player-refresh"==b||"string"!=typeof a&&"number"!=typeof a&&"boolean"!=typeof a||d.attr(b,a)}),a.require&&d.attr("label","* "+a.label),d}}function f(a,b){if(a.sections)if("tabs"==a.sections.type){var c=angular.element("<li ka-tabs></li>");c.attr("heading",a.sections.title);var d=angular.element("<div tabset></div>").appendTo(c);angular.forEach(a.sections.tabset,function(a){var c=angular.element('<div tab section="'+a.key+'" heading="'+a.title+'"></div>');$(b).find("li>div[section="+a.key+"]").each(function(a,b){$(b).parents("li").remove().appendTo(c)}),c.appendTo(d)}),b.prepend(c)}else"kaDynamicSection"==a.sections.type&&angular.forEach(a.sections.sectionsConfig,function(a,c){var d=angular.element('<li ka-dynamic-section model="data.'+a.model+'" section="'+c+'"></li>'),e=angular.element("<ul>");$(b).find("li>div[section="+c+"]").each(function(a,b){$(b).parents("li").remove().appendTo(e)}),$templateCache.put("dynamicSections/"+c,e),b.prepend(d)})}var g="";switch(a.type){case"menu":var h=angular.element('<div menu-level pagename="'+a.model+'" />');"undefined"!=typeof c&&(h.attr("parent-label",c.label),h.attr("parent-page",c.model));var i=e(a,h);g=d(a,i,!0),f(a,g);break;case"featuremenu":g=d(a,e(a,"featuremenu"));break;default:var j=JSON2directiveDictionary(a.type);j&&(g=e(a,j))}return g},menuSearch:function(searchValue){var foundLabel=search("menudata",menudata,searchValue);if(!foundLabel)return!1;var foundModelObj=eval(foundLabel.substr(0,foundLabel.lastIndexOf("['label']"))),foundModel=foundModelObj.model,lastChild=foundLabel.lastIndexOf("['children']"),lastMenu=foundLabel.substr(0,lastChild),menuPage=eval(lastMenu),featureMenu=[];if("object"==typeof menuPage){if("featuremenu"==menuPage.type)for(;"object"==typeof menuPage&&"featuremenu"==menuPage.type;)featureMenu.push(menuPage),lastChild=lastMenu.lastIndexOf("['children']"),menuPage=eval(lastMenu.substr(0,lastChild)),lastMenu=foundLabel.substr(0,lastChild);if("menu"==menuPage.type&&-1!==menuPage.model.indexOf(".")){var previousMenu=eval(lastMenu.substr(0,lastMenu.lastIndexOf("['children']")));menuSvc.setMenu(previousMenu.model),$timeout(function(){menuSvc.setMenu(menuPage.model)})}else menuSvc.setMenu(menuPage.model);return featureMenu.length&&angular.forEach(featureMenu,function(a){menuSvc.menuScope.$broadcast("openFeature","data."+a.model)}),$timeout(function(){menuSvc.menuScope.$broadcast("highlight","data."+foundModel),"featuremenu"==foundModelObj.type&&menuSvc.menuScope.$broadcast("openFeature","data."+foundModel)}),!0}},actions:[],registerAction:function(a,b,c){"function"==typeof b?menuSvc.actions[a]=c?{applyOn:c,funcData:b}:b:"object"==typeof b&&(menuSvc.actions[a]={applyOn:b,funcData:function(){return b}})},doAction:function(a,b){if("function"==typeof menuSvc.actions[a])return menuSvc.actions[a].call(b);if("object"==typeof menuSvc.actions[a]&&"function"==typeof menuSvc.actions[a].funcData){var c=menuSvc.actions[a].funcData.apply(menuSvc.actions[a].applyOn,b);return c}},getAction:function(a){return menuSvc.actions[a]},checkAction:function(a){return"function"==typeof menuSvc.actions[a]?!0:!1},makeFeatureCheckbox:function(a,b){if(b.model){var c=b.model.split(".");a.FeatureModel=c.pop();var d=c.join(".");a.parentModel=menuSvc.menuScope.$eval(d),a.featureModelCon=menuSvc.menuScope.$eval(b.model),a.featureCheckbox="false"==b.featureCheckbox?!1:!0,a.featureCheckbox&&(a.featureModelCon||(a.featureModelCon=a.parentModel?a.parentModel[a.FeatureModel]={_featureEnabled:!1}:{_featureEnabled:!1}),a.isDisabled=a.featureModelCon._featureEnabled?!1:!0)}},linkFn4FeatureCheckbox:function(a){a.featureCheckbox&&a.$watch("featureModelCon._featureEnabled",function(b,c){b!=c&&(b?(a.isDisabled=!1,a.parentModel&&(a.parentModel[a.FeatureModel]=a.featureModelCon)):(a.isDisabled=!0,"undefined"!=typeof a.isCollapsed?$timeout(function(){a.isCollapsed=!0}):"function"==typeof a.goBack&&a.goBack()))})}};return menuSvc}]).directive("featureMenu",["menuSvc",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/menu/featureMenu.html",transclude:!0,controller:["$scope","$element","$attrs",function(b,c,d){a.makeFeatureCheckbox(b,d),b.isCollapsed=!0,b.openFeature=function(){b.isCollapsed&&(b.isCollapsed=!1)},b.toggleFeature=function(){b.isCollapsed=!b.isCollapsed}}],scope:{label:"@",description:"@"},compile:function(b,c){return"false"!=c.endline&&b.append("<hr/>"),function(b,c,d){b.$watch("isCollapsed",function(a,c){a!=c&&b.$root.$broadcast("layoutChange")}),a.linkFn4FeatureCheckbox(b),b.$on("openFeature",function(a,c){c==d.model&&b.openFeature()})}}}}]).directive("model",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$on("highlight",function(b,e){if(d.model==e){var f=c;c.parent().is("li")&&(f=c.parent());var g=f.css("background")||"transparent";f.css({backgroundColor:"rgba(253,255,187,1)"}),a(function(){f.animate({backgroundColor:"rgba(253,255,187,0)"},1e3,function(){f.css({backgroundColor:g},1e3)})},4e3)}})}}}]).directive("navmenu",["menuSvc","$compile","$timeout","$routeParams","PlayerService",function(a,b,c,d){return{templateUrl:"template/menu/navmenu.html",restrict:"EA",priority:100,transclude:!0,controller:function(b){return b.scroller=null,a.menuScope=b,b.menuInitDone=!1,b.data=b.$parent.data,b.settings=b.$parent.settings,{spinnerScope:null}},compile:function(b){var e=b.find("#mp-base >  ul");return function(b,f,g,h){var i=a.buildMenu("data");a.spinnerScope=h.spinnerScope;var j=null;b.menuInitDone=!1,b.$on("menuChange",function(d,f){"search"!=f&&(-1===f.indexOf(".")&&0===e.children('[pagename="'+f+'"]').length&&i[f](b,function(a){a.appendTo(e)}),j&&c.cancel(j),j=c(function(){a.spinnerScope&&a.spinnerScope.endSpin(),j=null}))}),c(function(){var c=d.menuPage||"basicDisplay";"undefined"==typeof i[c]&&(cl("can not load requested page, perhaps a sub page ?"),c="basicDisplay"),a.setMenu(c),logTime("menuInitDone"),$("div.section[ng-view]").on("click",a.closeTooltips),b.menuInitDone=!0,b.$root.$broadcast("menuInitDone")},200).then(function(){c(function(){b.newPlayer||b.playerEdit.$setPristine()},500)})}}}}]).controller("menuSearchCtl",["$scope","menuSvc",function(a,b){var c=b.get();a.menuData=[],a.checkSearch=function(b){b&&console.log(b),a.notFound=!1,a.menuSearch&&a.searchMenuFn()},a.menuSearch="",a.searchMenuFn=function(){var c=b.menuSearch(a.menuSearch);c?a.menuSearch="":a.notFound=!0};var d=function(b){angular.forEach(b,function(b,e){b!=c[e]&&a.menuData.push(b.label),b.children&&d(b.children)})};d(c)}]).directive("menuLevel",["menuSvc","$window","$routeParams",function(a){return{templateUrl:"template/menu/menuPage.html",replace:!0,transclude:"true",restrict:"EA",controller:["$scope","$element","$attrs",function(b,c,d){a.makeFeatureCheckbox(b,d),d.parentPage||(b.isDisabled=!1),b.selfOpenLevel=function(){a.setMenu(d.pagename)},b.goBack=function(){a.setMenu(d.parentPage)},b.openLevel=function(a){return b.isOnTop="undefined"==typeof a?!0:a==b.pagename?!0:!1},b.isOnTop=!1}],compile:function(b,c){if("true"==c.endline&&b.find("div.header").append("<hr/>"),c.parentPage){var d=b.html();b.replaceWith(angular.element('<div type="menupage" class="form-element"></div>').append(d))}return function(b,c){b.$on("menuChange",function(a,c){b.openLevel(c)}),a.linkFn4FeatureCheckbox(b),b.$watch("isOnTop",function(a){a?(c.parents('.mp-level:not("#mp-base")').addClass("mp-level-in-stack"),c.children(".mp-level:first").addClass("mp-level-open").removeClass("mp-level-in-stack")):(c.children(".mp-level:first").removeClass("mp-level-open"),c.parents('.mp-level.mp-level-in-stack:not("#mp-base")').removeClass("mp-level-open mp-level-in-stack"))})}},scope:{label:"@",model:"=",pagename:"@",parentPage:"@",parentLabel:"@",description:"@"}}}]).directive("menuHead",["menuSvc","$compile",function(a,b){return{restrict:"EA",template:"<div id='mp-mainlevel'><ul></ul></div>",replace:!0,scope:{},transclude:!0,controller:["$scope","$element",function(b){b.activeItem=a.currentPage,b.changeActiveItem=function(c){b.activeItem!=c&&(b.activeItem=c,a.setMenu(c))}}],compile:function(c){var d=c.find("ul"),e=a.get();return function(c,f,g,h,i){i(c,function(a){d.prepend(a)}),angular.forEach(e,function(a){var e=angular.element("<li></li>");e.html("<a ng-click=\"changeActiveItem('"+a.model+'\')" class="icon icon-'+a.icon+'"  ng-class="{active: activeItem == \''+a.model+'\'}" tooltip-placement="right" tooltip="'+a.label+'"></a>'),b(e)(c).appendTo(d)}),c.$watch(function(){return a.currentPage},function(a,b){a!=b&&a!=c.activeItem&&c.changeActiveItem(a)})}}}}]),angular.module("KMCModule").controller("LoginCtrl",["$scope","apiService","$location","localStorageService","requestNotificationChannel","$filter",function(a,b,c,d,e,f){e.requestEnded("list"),a.formError=!0,a.formHelpMsg=f("translate")("You must login to use this application"),a.email="",a.pwd="",a.login=function(){b.doRequest({service:"user",action:"loginbyloginid",loginId:a.email,password:a.pwd}).then(function(a){d.isSupported()&&d.add("ks",a),b.setKs(a),c.path("/list")},function(b){a.formError=!0,a.formHelpMsg=b})}}]),angular.module("KMC.controllers",[]).controller("ModalInstanceCtrl",["$scope","$modalInstance","settings",function(a,b,c){a.title="",a.message="",a.buttons=[{result:!1,label:"Cancel",cssClass:"btn-default"},{result:!0,label:"OK",cssClass:"btn-primary"}],a.close=function(a){b.close(a)},a.cancel=function(){b.dismiss("cancel")},angular.extend(a,c)}]),angular.module("KMCModule").controller("PlayerCreateCtrl",["$scope","$filter","templates","userId","playerTemplates",function(a,b,c,d,e){a.title=b("translate")("New player - from template"),a.templates=c.data,a.templateType="system",a.userId=d,a.loading=!1,a.$watch("templateType",function(b,d){b!=d&&("user"==b?(a.loading=!0,e.listUser(a.userID).success(function(b){a.templates=b,a.loading=!1})):(a.loading=!0,a.templates=c.data,a.loading=!1))}),a.makeTooltip=function(b){var c=a.templates[b];return c&&"undefined"!=typeof c.settings&&"undefined"!=typeof c.settings.name?c.settings.name+"<br/>"+c.id+"<br/> Any information you will decide to show":void 0}}]),angular.module("KMCModule").controller("PlayerEditCtrl",["$scope","PlayerData","$routeParams","$filter","menuSvc","PlayerService","apiService","$timeout","requestNotificationChannel",function(a,b,c,d,e,f,g,h,i){logTime("editCntrlLoad"),a.playerId=b.id,a.newPlayer=!c.id,a.data=b,a.debug=c.debug,a.$on("$destory",function(){f.clearCurrentRefresh()}),a.getDebugInfo=function(b){return b?a.data[b]:a.data},a.masterData=angular.copy(a.data),a.userEntriesList=[],a.settings={},h(function(){g.listMedia().then(function(b){a.userEntries=b,angular.forEach(a.userEntries.objects,function(b){"undefined"==typeof b.playlistType&&a.userEntriesList.push({id:b.id,text:b.name})}),a.settings.previewEntry=f.getPreviewEntry()?f.getPreviewEntry():a.userEntriesList[0],f.setPreviewEntry(a.settings.previewEntry),f.playerRefresh().then(function(){e.menuScope.playerInitDone=!0})})},200),e.registerAction("listEntries",function(){return a.userEntriesList});var j=null;e.registerAction("queryEntries",function(b){if(!b.term)return b.callback({results:a.userEntriesList});var c={results:[]};j&&h.cancel(j),j=h(function(){g.searchMedia(b.term).then(function(a){return angular.forEach(a.objects,function(a){c.results.push({id:a.id,text:a.name})}),j=null,b.callback(c)})},200)}),a.$watch("settings.previewEntry",function(b,c){b!=c&&"undefined"!=typeof c&&(f.setPreviewEntry(a.settings.previewEntry),f.playerRefresh())}),i.requestEnded("edit")}]),angular.module("KMCModule").controller("editPageDataCntrl",["$scope","PlayerService","apiService","$modal","$location","menuSvc","localStorageService",function(a,b,c,d,e,f,g){a.autoRefreshEnabled=b.autoRefreshEnabled,a.$watch("autoRefreshEnabled",function(c,d){c!=d&&(c&&a.checkPlayerRefresh()&&b.playerRefresh(),b.autoRefreshEnabled=c)}),a.refreshPlayer=function(){b.playerRefresh().then(function(){b.refreshNeeded=!1})},a.checkPlayerRefresh=function(){return f.menuScope&&f.menuScope.menuInitDone&&f.menuScope.playerInitDone?b.refreshNeeded:!1},a.save=function(){b.savePlayer(a.data).then(function(b){f.menuScope.playerEdit.$setPristine(),a.masterData=b,g.remove("tempPlayerID"),a.newPlayer&&c.setCache(!1),d.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Save Player Settings",message:"Player Saved Successfully",buttons:[{result:!0,label:"OK",cssClass:"btn-primary"}]}}}})},function(a){d.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Player save failure",message:a}}}})})},a.formValidation=function(){if("undefined"!=typeof f.menuScope.playerEdit&&f.menuScope.playerEdit.$error){var a=f.menuScope.playerEdit.$error,b=!0;return angular.forEach(a,function(a){a!==!1&&(b=!1)}),b?null:a}},a.cancel=function(){if(f.menuScope.playerEdit.$pristine)e.url("/list");else{var a=d.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Navigation confirmation",message:"You are about to leave this page without saving, are you sure you want to discard the changes?"}}}});a.result.then(function(a){a&&e.url("/list")})}},a.saveEnabled=function(){return"undefined"!=typeof f.menuScope.playerEdit?f.menuScope.playerEdit.$valid?!angular.equals(a.data,a.masterData):!1:void 0}}]),angular.module("KMCModule").controller("PlayerListCtrl",["apiService","loadINI","$location","$rootScope","$scope","$filter","$modal","$timeout","$log","$compile","$window","localStorageService","requestNotificationChannel","PlayerService","$q","menuSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){m.requestStarted("list"),d.lang="en-US",e.search="",e.searchSelect2Options={},e.currentPage=1,e.maxSize=parseInt(l.get("listSize"))||10,e.$watch("maxSize",function(a,b){a!=b&&(l.set("listSize",a),e.$broadcast("layoutChange"))}),e.triggerLayoutChange=function(){e.$broadcast("layoutChange")},e.uiSelectOpts={width:"60px",minimumResultsForSearch:-1};var q=null;try{var r=window.parent.kmc;r&&r.vars&&r.vars.studio.config&&(q=r.vars.studio.config,e.UIConf=angular.fromJson(q))}catch(s){i.error("Could not located parent.kmc: "+s)}if(q||b.getINIConfig().success(function(a){e.UIConf=a}),l.get("tempPlayerID")){var t={service:"uiConf",action:"delete",id:l.get("tempPlayerID")};a.doRequest(t).then(function(){l.remove("tempPlayerID")})}p.menuScope.playerEdit&&!p.menuScope.playerEdit.$pristine&&(a.setCache(!1),n.clearCurrentPlayer());var u={"filter:tagsMultiLikeOr":"kdp3,html5studio","filter:orderBy":"-updatedAt","filter:objTypeEqual":"1","filter:objectType":"KalturaUiConfFilter","filter:creationModeEqual":"2",ignoreNull:"1","page:objectType":"KalturaFilterPager","pager:pageIndex":"1","pager:pageSize":"999",service:"uiConf",action:"list"};a.doRequest(u).then(function(a){e.data=a.objects,e.calculateTotalItems(),n.cachePlayers(a.objects),setTimeout(function(){e.triggerLayoutChange()},300)}),e.filtered=f("filter")(e.data,e.search)||e.data,e.calculateTotalItems=function(){e.filtered?e.totalItems=e.filtered.length:e.data&&(e.totalItems=e.data.length)},e.requiredVersion=n.getRequiredVersion(),e.sort={sortCol:"createdAt",reverse:!0},e.sortBy=function(a){e.sort.sortCol=a,e.sort.reverse=!e.sort.reverse},e.checkVersionNeedsUpgrade=function(a){var b=a.html5Url.substr(a.html5Url.indexOf("/v")+2,1);
return"1"==b||null===a.config},e.showSubTitle=!0,e.getThumbnail=function(a){return"undefined"!=typeof a.thumbnailUrl?a.thumbnailUrl:e.defaultThumbnailUrl},e.defaultThumbnailUrl="img/mockPlayerThumb.png";var v;e.$watch("search",function(a,b){e.showSubTitle=a,a.length>0?e.title=f("translate")("search for")+' "'+a+'"':b&&(e.title=f("translate")("Players list")),v&&h.cancel(v),v=h(function(){e.triggerLayoutChange(),e.calculateTotalItems(),v=null},100)}),e.oldVersionEditText=f("translate")("This player must be updated before editing. <br/>Some features and design may be lost.");var w=function(a){m.requestStarted("edit"),c.path("/edit/"+a)};e.goToEditPage=function(a,b){if(b&&b.preventDefault(),!e.checkVersionNeedsUpgrade(a))return w(a.id),!1;var c=e.oldVersionEditText,d=g.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Edit confirmation",message:c,buttons:[{result:!1,label:"Cancel",cssClass:"btn-default"},{result:!0,label:"Upgrade",cssClass:"btn-primary"}]}}}});d.result.then(function(b){b&&e.update(a).then(function(){w(a.id)})},function(){return i.info("edit when outdated modal dismissed at: "+new Date)})},e.newPlayer=function(){c.path("/new")},e.duplicate=function(a){n.clonePlayer(a).then(function(a){e.data.unshift(a[1]),n.cachePlayers(e.data),e.goToEditPage(a[1])})},e.deletePlayer=function(a){var b=g.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Delete confirmation",message:"Are you sure you want to delete the player?"}}}});b.result.then(function(b){b&&n.deletePlayer(a.id).then(function(){e.data.splice(e.data.indexOf(a),1),e.triggerLayoutChange()},function(a){g.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Delete failure",message:a}}}})})},function(){i.info("Delete modal dismissed at: "+new Date)})},e.update=function(a){var b=o.defer(),c=(a.html5Url.split("/v")[1].split("/")[0],"<span>"+f("translate")("Do you want to update this player?<br>Some features and design may be lost.")+"</span>"),d=a.html5Url.substr(0,a.html5Url.indexOf("/v")+2)+window.MWEMBED_VERSION+"/mwEmbedLoader.php",e=g.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Update confirmation",message:c}}}});return e.result.then(function(c){c&&n.playerUpdate(a,d).then(function(c){a.config=angular.fromJson(c.config),a.html5Url=d,a.tags="html5studio,player",b.resolve("upgrade finished successfully")},function(a){g.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Update player failure",message:a}}}}),b.reject("upgrade canceled")})},function(){i.info("Update player dismissed at: "+new Date),b.reject("upgrade canceled")}),b.promise}}]);var KMCServices=angular.module("KMC.services",[]);KMCServices.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),KMCServices.factory("apiCache",["$cacheFactory",function(a){return a("apiCache",{capacity:10})}]),KMCServices.factory("sortSvc",[function(){var a={},b={},c=function(b){this.name=b,this.elements=[],a[b]=this};return c.prototype.addElement=function(a){this.elements.push(a)},c.prototype.callObjectsUpdate=function(){angular.forEach(this.elements,function(a){cl(a.sortVal+" "+a.model)})},c.prototype.removeElement=function(a){var b=this.elements.indexOf(a);-1!=b&&this.elements.splice(b,1)},b.sortScope="",b.register=function(b,d){var e="undefined"==typeof a[b]?new c(b):a[b];e.addElement(d)},b.update=function(d,e,f){var g=a[e],h=a[d]?a[d]:new c(d);g&&g.removeElement(f),h.addElement(f),"object"==typeof b.sortScope&&b.sortScope.$broadcast("sortContainersChanged")},b.getObjects=function(){return a},b.saveOrder=function(b){a=b,angular.forEach(a,function(a){a.callObjectsUpdate()})},b}]),KMCServices.factory("PlayerService",["$http","$modal","$log","$q","apiService","$filter","localStorageService",function(a,b,c,d,e,f,g){var h,i,j={},k={},l="kVideoTarget",m=null,n=!1,o=function(){q.refreshNeeded=!1,m.resolve(!0),m=null,n&&(n=!1,p()),logTime("renderPlayerDone")},p=function(){if(m)n=!0;else{m=d.defer();try{q.renderPlayer(o)}catch(a){m.reject(a)}}return m.promise},q={autoRefreshEnabled:!1,clearCurrentRefresh:function(){m=null},refreshNeeded:!1,getCurrentRefresh:function(){return m},clearCurrentPlayer:function(){k={}},setPreviewEntry:function(a){g.set("previewEntry",a),h=a.id,i=a},getPreviewEntry:function(){return h?i:g.get("previewEntry")},renderPlayer:function(a){if(logTime("renderPlayer"),!k||"undefined"==typeof kWidget)throw function(){return"player could not be rendered"};var b=angular.copy(k.config);b.plugins=q.preparePluginsDataForRender(b.plugins);var c={jsonConfig:angular.toJson(b)};$("html").hasClass("IE8")&&angular.extend(c,{wmode:"transparent"}),$("#Companion_300x250").empty(),$("#Companion_728x90").empty(),window.mw.setConfig("forceMobileHTML5",!0),window.mw.setConfig("Kaltura.EnableEmbedUiConfJs",!0),kWidget.embed({targetId:l,wid:"_"+k.partnerId,uiconf_id:k.id,flashvars:c,entry_id:h,readyCallback:function(b){document.getElementById(b).kBind("layoutBuildDone",function(){"function"==typeof a&&a()})}})},setKDPAttribute:function(a,b){var c=document.getElementById("kVideoTarget");if($.isFunction(c.setKDPAttribute)&&"undefined"!=typeof a&&-1!=a.indexOf(".")){var d=a.split(".")[0],e=a.split(".")[1];c.setKDPAttribute(d,e,b)}},playerRefresh:p,newPlayer:function(){var a=d.defer();return q.getDefaultConfig().success(function(b){var c={service:"uiConf",action:"add","uiConf:objectType":"KalturaUiConf","uiConf:objType":1,"uiConf:description":"","uiConf:height":"395","uiConf:width":"560","uiConf:swfUrl":"/flash/kdp3/v3.9.8/kdp3.swf","uiConf:fUrlVersion":"3.9.8","uiConf:version":"161","uiConf:name":"New Player","uiConf:tags":"html5studio,player","uiConf:html5Url":"/html5/html5lib/v"+window.MWEMBED_VERSION+"/mwEmbedLoader.php","uiConf:creationMode":2,"uiConf:config":angular.toJson(b)};e.setCache(!1),e.doRequest(c).then(function(b){q.setCurrentPlayer(b),e.setCache(!0),g.set("tempPlayerID",b.id),a.resolve(b)},function(b){a.reject(b)})}).error(function(){cl("Error getting default player config")}),a.promise},clonePlayer:function(a){var b=d.defer(),c={service:"multirequest",action:null,"1:service":"uiconf","1:action":"clone","1:id":a.id,"2:service":"uiconf","2:action":"update","2:id":"{1:result:id}","2:uiConf:name":"Copy of "+a.name,"2:uiConf:objectType":"KalturaUiConf"};return e.doRequest(c).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},getPlayer:function(a){var b=!1,c=d.defer();if("undefined"!=typeof k.id&&(k.id==a||"currentEdit"==a)&&(k.config.plugins=this.preparePluginsDataForRender(k.config.plugins),q.setCurrentPlayer(k),c.resolve(k),b=!0),b||"undefined"!=typeof j[a]&&(q.setCurrentPlayer(j[a]),c.resolve(k),b=!0),!b){var f={service:"uiConf",action:"get",id:a};e.doRequest(f).then(function(a){q.setCurrentPlayer(a),c.resolve(k)})}return c.promise},setCurrentPlayer:function(a){"string"==typeof a.config&&(a.config=angular.fromJson(a.config)),"undefined"!=typeof a.config&&"undefined"!=typeof a.config.plugins&&(a.config=q.addFeatureState(a.config)),k=a},addFeatureState:function(a){return angular.forEach(a.plugins,function(b,c){$.isArray(b)&&(a.plugins[c]={}),a.plugins[c]._featureEnabled!==!1&&(a.plugins[c]._featureEnabled=!0)}),a},cachePlayers:function(a){$.isArray(a)?angular.forEach(a,function(a){j[a.id]=a}):j[a.id]=a},deletePlayer:function(a){var b=d.defer(),c=f("translate")("Delete action was rejected: ");if("undefined"==typeof a&&k&&(a=k.id),a){var g={service:"uiConf",action:"delete",id:a};e.doRequest(g).then(function(a){b.resolve(a)},function(a){b.reject(c+a)})}else b.reject(c);return b.promise},getRequiredVersion:function(){return 2},getDefaultConfig:function(){return a.get("js/services/defaultPlayer.json")},preparePluginsDataForRender:function(a){var b=a.plugins||a;return angular.forEach(b,function(a,c){angular.isObject(a)?"undefined"==typeof a._featureEnabled||a._featureEnabled===!1?delete b[c]:q.preparePluginsDataForRender(a):"_featureEnabled"==c&&(b.plugin=!0,delete b[c])}),b},savePlayer:function(a){var b=d.defer(),c=angular.copy(a.config);c.plugins=q.preparePluginsDataForRender(c.plugins);var f={service:"uiConf",action:"update",id:a.id,"uiConf:name":a.name,"uiConf:tags":a.tags,"uiConf:description":a.description?a.description:"","uiConf:config":angular.toJson(c)};return e.doRequest(f).then(function(c){j[a.id]=a;var d=window.parent.kmc;d&&d.preview_embed&&d.preview_embed.updateList(!1),b.resolve(c)}),b.promise},playerUpdate:function(b,h){var i=d.defer(),j=f("translate")("Update player action was rejected: "),k="get",l=window.kWidget.getPath()+"services.php",m={service:"upgradePlayer",uiconf_id:b.id,ks:g.get("ks")};return window.IE<10&&(m.callback="JSON_CALLBACK",k="jsonp"),a({url:l,method:k,params:m}).success(function(a){a.uiConfId&&(delete a.uiConfId,delete a.widgetId,delete a.vars.ks);var c={service:"uiConf",action:"update",id:b.id,"uiConf:tags":"html5studio,player","uiConf:html5Url":h,"uiConf:config":angular.toJson(a).replace('"vars":','"uiVars":')};e.doRequest(c).then(function(a){i.resolve(a)},function(a){i.reject(j+a)})}).error(function(a){i.reject("Error updating UIConf: "+a),c.error("Error updating UIConf: "+a)}),i.promise}};return q}]),KMCServices.factory("requestNotificationChannel",["$rootScope",function(a){var b="_START_REQUEST_",c="_END_REQUEST_",d={customStart:null};return d.requestStarted=function(c){a.$broadcast(b,c),c&&(d.customStart=c)},d.requestEnded=function(b){if(d.customStart){if(b!=d.customStart)return;a.$broadcast(c,b),d.customStart=null}else a.$broadcast(c)},d.onRequestStarted=function(a,c){a.$on(b,function(a,b){"ignore"!=b&&c()})},d.onRequestEnded=function(a,b){a.$on(c,function(a,c){"ignore"!=c&&b()})},d}]),KMCServices.directive("canSpin",[function(){return{require:["?^loadingWidget","?^navmenu"],priority:1e3,link:function(a,b,c,d){a.target=$('<div class="spinWrapper"></div>').prependTo(b),a.spinner=null,a.spinRunning=!1,a.opts={lines:15,length:27,width:8,radius:60,corners:1,rotate:0,direction:1,color:"#000",speed:.6,trail:24,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};var e=function(){a.spinner=new Spinner(a.opts).spin()};a.endSpin=function(){a.spinner&&a.spinner.stop(),a.spinRunning=!1},a.spin=function(){a.spinRunning||(null===a.spinner&&e(),a.spinner.spin(a.target[0]),a.spinRunning=!0)},angular.forEach(d,function(b){"undefined"!=typeof b&&(b.spinnerScope=a)})}}}]),KMCServices.directive("loadingWidget",["requestNotificationChannel",function(a){return{restrict:"EA",scope:{},replace:!0,controller:function(){},template:"<div class='loadingOverlay'><a can-spin></a></div>",link:function(b,c,d,e){c.hide();var f=function(){c.show(),e.spinnerScope.spin()},g=function(){c.hide(),e.spinnerScope.endSpin()};a.onRequestStarted(b,f),a.onRequestEnded(b,g)}}}]),KMCServices.factory("editableProperties",["$q","api","$http",function(a,b,c){var d=a.defer();return b.then(function(){var a="get",b=window.kWidget.getPath()+"services.php?service=studioService";window.IE<10&&(b+="&callback=JSON_CALLBACK",a="jsonp"),c[a](b).then(function(a){var b=a.data;"object"==typeof b?d.resolve(a.data):(cl("JSON parse error of playerFeatures"),d.reject(!1))},function(a){d.reject(a)})}),d.promise}]),KMCServices.factory("loadINI",["$http",function(a){var b=null;return{getINIConfig:function(){return b||(b=a.get("studio.ini",{responseType:"text",headers:{"Content-type":"text/plain"},transformResponse:function(a){var b=a.match(/widgets\.studio\.config \= \'(.*)\'/)[1];return a=angular.fromJson(b)}})),b}}}]),KMCServices.provider("api",function(){var a=angular.injector(["ng"]),b=a.get("$q"),c=null;return{$get:["loadINI",function(a){var d=b.defer();if(c)d.resolve(c);else{var e=function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.src=a,d.type="text/javascript",d.addEventListener?d.addEventListener("load",b,!1):d.readyState&&(d.onreadystatechange=b),c.appendChild(d)},f=function(a){var b=function(){"undefined"!=typeof kWidget&&(kWidget.api.prototype.type="POST",c=new kWidget.api,d.resolve(c))};e(a,function(){"undefined"==typeof kWidget?setTimeout(function(){b()},100):b()})},g=null;try{var h=window.parent.kmc;if(h&&h.vars&&h.vars.studio.config){var i=angular.fromJson(h.vars.studio.config);g=h.vars.api_url+"/html5/html5lib/"+i.html5_version+"/mwEmbedLoader.php",f(g)}}catch(j){cl("Could not located parent.kmc: "+j)}g||a.getINIConfig().success(function(a){var b=a.html5lib;f(b)})}return d.promise}]}}),KMCServices.factory("apiService",["api","$q","$timeout","$location","localStorageService","apiCache","requestNotificationChannel","$filter",function(a,b,c,d,e,f,g,h){var i={apiObj:a,unSetks:function(){delete i.apiObj},setKs:function(a){i.apiObj.then(function(b){b.setKs(a)})},setWid:function(a){i.getClient().then(function(b){b.wid=a})},getKey:function(a){var b="";for(var c in a)b+=a[c]+"_";return b},listMedia:function(){var a={service:"baseentry",action:"list"};return i.doRequest(a)},searchMedia:function(a){var b={service:"baseentry",action:"list","filter:freeText":a,"filter:mediaTypeIn":"1,2,5,6,201","filter:objectType":"KalturaMediaEntryFilter",ignoreNull:"1"};return i.doRequest(b,!0)},useCache:!0,setCache:function(a){i.useCache=a},doRequest:function(a,c){var j=b.defer(),k=i.getKey(a);return f.get(k)&&i.useCache?j.resolve(f.get(k)):(c||g.requestStarted("api"),i.apiObj.then(function(b){b.doRequest(a,function(a){if(a.code){"INVALID_KS"==a.code&&(e.remove("ks"),d.path("/login")),c||g.requestEnded("api");var b=h("translate")(a.code);j.reject(b)}else f.put(k,a),i.useCache=!0,c||g.requestEnded("api"),j.resolve(a)})})),j.promise}};return i}]),KMCServices.factory("playerTemplates",["$http",function(a){return{listSystem:function(){return a.get("http://mrjson.com/data/5263e32d85f7fef869f2a63b/template/list.json")},listUser:function(){return a.get("http://mrjson.com/data/5263e32d85f7fef869f2a63b/userTemplates/list.json")}}}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("mcustomScrollbar",["$timeout",function(a){return{priority:0,scope:{},restrict:"AC",link:function(b,c,d){var e,f="99%";if("search"!=b.pagename){b.scroller=null;var g=b.$eval(d.mcustomScrollbar),h=null;b.$on("layoutChange",function(){h&&a.cancel(h),h=a(function(){b.scroller&&b.scroller.mCustomScrollbar("update"),h=null},300)});var i={horizontalScroll:!1,mouseWheel:!0,autoHideScrollbar:!0,contentTouchScroll:!0,theme:"dark",set_height:f,advanced:{autoScrollOnFocus:!1,updateOnBrowserResize:!0,updateOnContentResize:!1}};angular.extend(i,g);var j=function(){return a(function(){"function"==typeof $().mCustomScrollbar&&(b.scroller?b.scroller.mCustomScrollbar("update"):b.scroller=c.mCustomScrollbar(i))},1e3)};d.menuscroller?b.$on("menuChange",function(a,c){d.menuscroller==c?j():b.scroller&&(b.scroller.mCustomScrollbar("destroy"),b.scroller=null)}):e=j();var k=function(a){"block"==a?$("#tableHead").css("padding-right","18px"):$("#tableHead").css("padding-right","0px")};"list"==b.$root.routeName&&$("#tableHead").length&&e.then(function(){var d=$(c).find(".mCSB_scrollTools");b.scrollerCss=d.css("display"),a(function(){k(b.scrollerCss)},200),b.$watch(function(){return b.scrollerCss=d.css("display")},function(a){k(a)});var e;$(window).resize(function(){e&&a.cancel(e),e=a(function(){k(d.css("display")),e=null},200)})})}}}}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("modelCheckbox",function(){return{restrict:"EA",templateUrl:"template/formcontrols/modelCheckbox.html",require:"?playerRefresh",replace:!0,compile:function(a,b){return"true"==b.endline&&a.append("<hr/>"),function(a,b,c,d){d&&d.setValueBased()}},controller:["$scope","$element","$attrs",function(a,b,c){(""===a.model||"undefined"==typeof a.model)&&"true"===c.initvalue&&(a.model=!0)}],scope:{label:"@",helpnote:"@",model:"=",require:"@"}}}).directive("prettycheckbox",function(){return{restrict:"AC",require:["ngModel","?playerRefresh"],template:'<a data-ng-click="check()"></a>',link:function(a,b,c,d){var e=d[0],f=d[1];f&&f.setValueBased();var g=$(b).find("a");a.check=function(){e.$setViewValue(!e.$viewValue)};var h=function(a){var b="undefined"!=typeof a?a:e.$modelValue;return b?g.addClass("checked"):g.removeClass("checked"),b};e.$render=h,e.$parsers.push(h),a.require&&e.$setValidity("required",!0)}}});var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("modelColor",[function(){return{restrict:"EA",priority:10,require:"?playerRefresh",replace:!0,controller:["$scope","$element","$attrs",function(a,b,c){"undefined"==typeof a.model&&(a.model=c.initvalue?c.initvalue:"#ffffff"),a.initValue=a.model.toString()}],link:function(a,b,c,d){d&&d.setValueBased()},scope:{label:"@",strModel:"@model",helpnote:"@",model:"="},templateUrl:"template/formcontrols/modelColor.html"}}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("modelNumber",["menuSvc",function(){return{templateUrl:"template/formcontrols/modelNumber.html",replace:!0,restrict:"EA",priority:10,scope:{model:"=",helpnote:"@",label:"@",require:"@",strModel:"@model"},controller:["$scope","$element","$attrs",function(a,b,c){return a.defaults={initvalue:parseInt(c.initvalue)||0,from:parseInt(c.from)||0,to:parseInt(c.to)||1e3,stepSize:parseInt(c.stepsize)||1,readonly:!1},a.inputForm={},"number"==typeof a.model||"string"==typeof a.model&&parseInt(a.model)||(a.model=a.defaults.initvalue||0),a}]}}]).directive("numberInput",["$timeout","$q",function(a){return{require:["^modelNumber","ngModel","?^playerRefresh"],restrict:"A",priority:500,scope:!0,templateUrl:"template/formcontrols/numberInput.html",link:function(b,c,d,e){var f=e[0],g=e[1],h=c.find("input");f.modelCntrl=g,f.inputForm=b.inputForm;var i=e[2]?e[2]:null,j=null;i&&i.setUpdateFunction(function(b){h.on("change softChange",function(){j&&a.cancel(j),j=a(function(){b.$emit("controlUpdateAllowed",b.prModel.key),j=null},1e3)})}),"number"==typeof b.model||"string"==typeof b.model&&parseInt(b.model)||g.$setViewValue(b.defaults.initvalue||0),h.on("blur change",function(){var a=h.val();""===a?b.$apply(function(){g.$setViewValue(b.defaults.initvalue||0)}):(a=parseInt(a),b.passValidation(a)&&b.$apply(function(){k(a)}))}),h.on("keydown",function(a){(38==a.keyCode||40==a.keyCode)&&(a.preventDefault(),b.$apply(function(){38==a.keyCode?b.increment():b.decrement()}))}),g.$parsers.push(function(a){return f.model=a});var k=function(a){h.trigger("softChange"),g.$setViewValue(a)};b.increment=function(){var a=g.$viewValue+b.defaults.stepSize;a<b.defaults.to?k(a):k(b.defaults.to)},b.passValidation=function(a){return"number"==typeof a&&a>b.defaults.from&&a<b.defaults.to?!0:void 0},b.decrement=function(){var a=g.$viewValue-b.defaults.stepSize;a>b.defaults.from?k(a):k(b.defaults.from)}}}}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.provider("sections",[function(){var a={dynamic:"template/menu/dynamicSections.html",tabs:"template/menu/tabs.html"};this.$get=["$compile","menuSvc","$templateCache",function(b,c,d){return function(e){return{restrict:"AE",replace:!0,templateUrl:a[e],transclude:!0,scope:function(){return"tabs"==e?{heading:"@"}:"dynamic"==e?{modelData:"=model"}:void 0}(),controller:function(a,f,g){if("tabs"==e)a.tabset={heading:g.heading};else if("dynamic"==e){a.configData=c.getControlData(g.model),a.configData.sectionName=g.section;var h=[1];"undefined"!=typeof a.modelData.sections?(h=a.modelData.sections.split(","),h.length<=0&&(cl("section"+g.section+" has been reset because of bad data"),h=[1],a.modelData.sections=1)):(a.modelData=c.getOrMakeModelData(g.model,!0),a.modelData.sections=1),a.modelData._featureEnabled=!0;var i=angular.element('<a class="btn btn-xs" ng-click="removeSection($event)">X</a>'),j=angular.element('<div class="dynSection" index=""></div>'),k=j.append(i),l=function(e){var g=b(k.clone().attr("index",e))(a),h=d.get("dynamicSections/"+a.configData.sectionName).clone();n(h,e);var i=b(h)(c.menuScope);f.find("div.dynSections").append(g.append(i))},m=function(b,c){"undefined"==typeof c&&(c="");var d=a.configData.modelPre,e=a.configData.modelPost;return-1!=d.indexOf("#")&&(d=d.replace("#",c)),-1!=e.indexOf("#")&&(e=e.replace("#",c)),d+b+e},n=function(a,b){a.find("[model]").each(function(a,c){$(c).attr("model",m($(c).attr("model"),b))})},o=function(a){a.find("[model]").each(function(a,b){var d=$(b).attr("model"),e=c.getModalData(c.getKnownParent(d));if(e){var f=d.substr(d.lastIndexOf(".")+1);"undefined"!=typeof e[f]&&delete e[f]}})};angular.forEach(h,function(b){1==b&&a.configData.remove1===!0?l():l(b)}),a.addSection=function(){l(h.length+1),h.push(h.length+1),a.modelData.sections+=","+h.length},a.removeSection=function(b){var c=$(b.target).parent(),d=$(c).attr("index");(d===!0||""===d)&&(d=0),o(c),c.remove(),h.splice(d-1,1),a.modelData.sections=h.join(",")}}},link:function(){}}}}]}]),DirectivesModule.directive("kaDynamicSection",["sections",function(a){return a("dynamic")}]),DirectivesModule.directive("kaTabs",["sections",function(a){return a("tabs")}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("modelSelect",["menuSvc",function(a){return{replace:!0,restrict:"EA",priority:1,require:["?parentContainer"],scope:{label:"@",model:"=",initvalue:"@",helpnote:"@",selectOpts:"@",strModel:"@model",require:"@"},compile:function(b,c){return"true"==c.endline&&b.append("<hr/>"),function(b,c,d,e){var f=e[0]?e[0]:null;if(f){var g={model:d.model,label:d.label.replace("Location",""),sortVal:a.getControlData(d.model).sortVal};f.register(b.model,g),b.$watch("model",function(a,b){a!=b&&f.update(a,b,g)})}var h=a.getControlData(d.model);h&&(b.options=h.options)}},controller:["$scope","$element","$attrs",function(a,b,c){a.selectOpts||(a.selectOpts={}),c.placehold&&(a.selectOpts.placeholder=c.placehold),c.showSearch||(a.selectOpts.minimumResultsForSearch=-1),a.options=[],a.checkSelection=function(b){return b==a.model?!0:"number"==typeof b&&parseFloat(a.model)==b?!0:!1},a.initSelection=function(){return(""===a.model||"undefined"==typeof a.model)&&(a.model=c.initvalue),a.model},a.selectOpts.initSelection=a.initSelection(),a.uiselectOpts=angular.toJson(a.selectOpts),a.setOptions=function(b){a.options=b}}],templateUrl:"template/formcontrols/modelSelect.html"}}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("modelText",["menuSvc",function(a){return{replace:!0,restrict:"EA",controller:["$scope","$element","$attrs",function(b,c,d){b.type="text";var e=a.menuScope.playerEdit,f=function(a,c){b.$watch(function(){if(e[d.model]){var b=e[d.model];return"undefined"!=typeof b.$error[a],b.$error[a]}return!1},function(a){b[c]=a})};if(b.require&&f("required","reqState"),!d.initvalue||"undefined"!=typeof b.model&&""!==b.model||(b.model=d.initvalue),"url"==d.validation||"email"==d.validation)f(d.validation,"valState"),b.type=d.validation;else{var g,h,i=d.validation;try{h=new RegExp(i,"i"),g=!0}catch(j){g=!1}g&&(b.validation=h,f("pattern","valState"))}"undefined"==typeof b.validation&&(b.validation={test:function(){return!0},match:function(){return!0}}),b.isDisabled=!1}],scope:{label:"@",model:"=",icon:"@",placehold:"@",strModel:"@model",helpnote:"@",require:"@"},compile:function(a,b){return"true"==b.endline&&a.append("<hr/>"),function(a,b,c){var d=$(b).find("input");c.initvalue&&d.on("click",function(a){d.val()==c.initvalue&&(a.preventDefault(),d.select())})}},templateUrl:"template/formcontrols/modelText.html"}}]),DirectivesModule.directive("ngPlaceholder",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=("url"==c.type||"url"==c.valType)&&c.ngPlaceholder.length<=0?"http://":c.ngPlaceholder,f=function(){b.val(e),c.require&&d.$setValidity("required",!1),b.addClass("placeholder")},g=function(){"http://"!=e&&b.val(""),b.removeClass("placeholder")},h=d.$viewValue,i=function(a){return h=a,!a&&e.length>0?(f(),""):a};d.$parsers.unshift(i),d.$formatters.unshift(i),b.bind("focus",function(){(""===h||h==e)&&g()}),b.bind("blur",function(){(""===b.val()||h==e)&&f()})}}});var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("multipleValueInput",function(){return{templateUrl:"template/formcontrols/multipleValueInput.html",replace:!0,scope:{model:"=",label:"@",icon:"@"},controller:["$scope","$element","$attrs",function(a,b,c){a.splitModel=[],c.initvalue&&!a.model&&(a.model=c.initvalue),a.remove=function(b){a.splitModel.splice(b,1)},a.splitChar=c.splitChar||";",a.model&&(a.splitModel=a.model.split(a.splitChar),""===a.splitModel[a.splitModel.length-1]&&a.splitModel.splice(a.splitModel.length-1,1)),a.add=function(){a.splitModel.push("")}}],compile:function(a,b){return b.endline&&a.append("<hr/>"),function(a){a.$watchCollection("splitModel",function(b,c){if(b!==c){var d="";angular.forEach(b,function(b){$.trim(b).length&&(d+=b+a.splitChar)}),d!==a.model&&(a.model=d)}})}}}});var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("playerRefresh",["PlayerService","menuSvc","$timeout","$interval",function(a,b,c,d){return{restrict:"A",priority:100,scope:!0,require:["?ngModel"],controllerAs:"prController",controller:function(b,c,e){b.options={valueBased:!1},b.prModel={key:"",value:null,valueChanged:!1,oldValue:null},b.updateFunction=function(a,b){var c;c=b.is("input")||b.is("select")?b:$(b).find("input[ng-model], select[ng-model]");var d="change";c.is("input")&&(d="blur"),c.on(d,function(){a.$emit("controlUpdateAllowed",a.prModel.key)})};var f=null;b.$on("$destroy",function(){f&&d.cancel(f)});var g={makeRefresh:function(){a.playerRefresh(e.playerRefresh).then(function(){b.prModel.valueChanged=!1})},setValueBased:function(){b.options.valueBased=!0},setUpdateFunction:function(a){b.updateFunction=a}};return g},link:function(d,e,f,g){"boolean"==f.playerRefresh&&(d.options.valueBased=!0);var h=g[0]?g[0]:null;"false"!=f.playerRefresh&&(d.prModel.key=h?f.ngModel:f.model),c(function(){d.options.valueBased||(d.updateFunction(d,e),d.$parent.$parent.$on("controlUpdateAllowed",function(a,b){b==d.prModel.key&&d.prModel.valueChanged===!0&&(a.stopPropagation(),d.prController.makeRefresh())}));var c=function(){"true"==f.playerRefresh?"featureModelCon._featureEnabled"==d.prModel.key?d.prController.makeRefresh():a.autoRefreshEnabled?d.options.valueBased?d.prController.makeRefresh():(d.prModel.valueChanged=!0,a.refreshNeeded=!0):a.refreshNeeded=!0:"aspectToggle"==f.playerRefresh?$("#spacer").toggleClass("narrow"):a.setKDPAttribute(f.playerRefresh,d.prModel.value)};h?(d.prModel.value=h.$modelValue,h.$viewChangeListeners.push(function(){d.prModel.oldValue=d.prModel.value,d.prModel.value=h.$viewValue,d.prModel.oldValue!=d.prModel.value&&c()})):(d.prModel.value=b.getModalData(f.model),d.$watch(function(){return d.prModel.value=b.getModalData(f.model)},function(a,b){a!=b&&c()}))},100)}}}]);var DirectivesModule=angular.module("KMC.directives");DirectivesModule.directive("select2Data",["menuSvc","$filter",function(a,b){return{replace:!0,restrict:"EA",scope:{label:"@",model:"=",icon:"@",helpnote:"@",initvalue:"@",require:"@",strModel:"=model"},controller:["$scope","$element","$attrs",function(c,d,e){if(c.selectOpts={},"undefined"!=typeof e.flatmodel){var f=a.getModalData("data."+e.flatmodel);f&&(c.model={id:f,text:f})}"undefined"!=typeof e.allowCustomValues&&(c.selectOpts.createSearchChoice=function(a){var c=b("translate")(e.allowCustomValues);return{id:a,text:a+" ("+c+")"}}),c.selectOpts.data=a.doAction(e.source),e.query&&(c.selectOpts.data.results=[],e.minimumInputLength&&(c.selectOpts.minimumInputLength=e.minimumInputLength),c.selectOpts.query=a.getAction(e.query)),e.placehold&&(c.selectOpts.placeholder=e.placehold),c.selectOpts.width=e.width}],templateUrl:"template/formcontrols/select2Data.html",compile:function(b,c){return"true"==c.endline&&b.append("<hr/>"),"true"==c.showEntriesThumbs&&b.find("input").attr("list-entries-thumbs","true"),c.placeholder&&b.find("input").attr("data-placeholder",c.placeholder),function(b,c,d){"undefined"!=typeof d.flatmodel&&b.$watch("model",function(b,c){b!=c&&a.setModelData(d.flatmodel,b.id)})}}}}]);